# TickerOneStock（简化版）

一个极简的 Chrome 扩展：在任意网页上显示单只标的的悬浮行情气泡。当前实现专注“单标的 + 本地联想 + 最小权限”。

## 功能

- 悬浮气泡：展示最新价格与涨跌幅，统一由后台轮询并广播到所有已打开标签页。
- 本地联想：选项页输入中文或代码做本地匹配（东方财富 push2 全量索引，本地缓存）。
- 全量索引维护：
  - 每天 06:00 自动从东财 push2 拉取（主板/科创/深证A/创业板/中小板，分页拉满，失败自动重试）。
  - 选项页支持手动获取/更新；后台失败时，页面内可兜底拉取。
  - 选项页显示最近获取“成功/失败 + 时间 + 数量/错误”。
- 导出索引：一键导出本地缓存为 `stocks-YYYYMMDD.json`。
- 最小权限：仅行情源（腾讯/新浪）、索引源（东财）、`storage/tabs/alarms/downloads`。

## 安装

1) 打开 `chrome://extensions/` → 开启“开发者模式”。
2) 点击“加载已解压的扩展程序”，选择仓库中的 `extension/` 目录。

## 使用

- 配置标的：
  - 选项页输入中文或代码搜索本地索引，选择后会填入“中文名  标准代码”（如：贵州茅台  sh600519）。
  - 保存时仅写入标准代码（`sh|sz + 6 位`）。
- 本地联想：
  - 默认仅使用本地索引；点击“手动获取/更新”可立即刷新全量；状态栏会提示结果与条数。
  - 首次使用建议先手动更新一次全量。
- 导出索引：
  - 点击“导出为 JSON”下载当前本地索引到你的电脑。
- 多标签页广播：
  - 后台统一抓取行情，自动推送到所有标签页，保证显示一致。

## 权限

- host_permissions
  - `https://qt.gtimg.cn/*`（腾讯实时行情）
  - `https://hq.sinajs.cn/*`（新浪实时行情）
  - `https://push2.eastmoney.com/*`（东方财富全量索引）
- permissions
  - `storage`, `tabs`, `alarms`, `downloads`

## 常见问题

- 只匹配到 ~100 条？
  - 已改为分板块 + 分页抓取，覆盖主板/科创/深证A/创业板/中小板；失败自动重试；手动刷新也使用相同逻辑。
- 选择了 A，保存成了 B？
  - 保存时优先解析输入框中的标准代码；若无代码再做“中文名/纯 6 位代码”的精确匹配，不会读取下拉第一条，避免误选。
- 无法从东财拉取？
  - 后台有重试；若仍失败，可在选项页点击“手动获取/更新”，会在页面内兜底拉取并缓存。

## 目录（简）

```
extension/
├─ background.js      # 后台轮询行情 + 每日索引刷新 + 重试 + 广播
├─ content.js         # 页面内悬浮气泡（接收广播并展示）
├─ options.html/.js   # 选项页：配置标的、本地联想、索引状态、导出
├─ manifest.json      # MV3 配置与权限
└─ stocks.json        # 内置少量示例，首启兜底
```

欢迎提交 Issue / PR 改进体验，或将本项目作为你的自定义行情插件模板。
